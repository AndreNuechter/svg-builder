const ht=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))r(a);new MutationObserver(a=>{for(const c of a)if(c.type==="childList")for(const i of c.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&r(i)}).observe(document,{childList:!0,subtree:!0});function n(a){const c={};return a.integrity&&(c.integrity=a.integrity),a.referrerpolicy&&(c.referrerPolicy=a.referrerpolicy),a.crossorigin==="use-credentials"?c.credentials="include":a.crossorigin==="anonymous"?c.credentials="omit":c.credentials="same-origin",c}function r(a){if(a.ep)return;a.ep=!0;const c=n(a);fetch(a.href,c)}};ht();window.addEventListener("load",()=>{const e=({target:{parentElement:t}})=>{t.classList.toggle("closed"),t.classList.toggle("open")};[...document.getElementsByClassName("togglable")].forEach(t=>{t.firstElementChild.onclick=e,!t.classList.contains("open")&&!t.classList.contains("closed")&&t.classList.add("closed")})},{once:!0});const U=({x:e,y:t})=>`${e} ${t}`,Ae={H:({x:e})=>e,V:({y:e})=>e,Q:({x:e,x1:t,y:n,y1:r})=>`${t} ${r} ${e} ${n}`,C:({x:e,x1:t,x2:n,y:r,y1:a,y2:c})=>`${t} ${a} ${n} ${c} ${e} ${r}`,A:({x:e,xR:t,xRot:n,y:r,yR:a,large:c,sweep:i})=>`${t} ${a} ${n} ${c} ${i} ${e} ${r}`,S:({x:e,x1:t,y:n,y1:r})=>`${t} ${r} ${e} ${n}`,T:U,M:U,L:U},ge=33,ye=(e,t,n,r)=>e<t?n>r?-ge:ge:0,Ne=(e,t,n,r)=>{const a=Math.abs(n-e),c=Math.abs(r-t),i=Math.min(e,n),l=Math.min(t,r),f=ye(c,a,n,e),S=ye(a,c,r,t);return{xMin:i,yMin:l,yOffset:f,xOffset:S}};function De(e){return{xR:e.xR,yR:e.yR,xRot:e.xRot,large:+e.large,sweep:+e.sweep}}function vt(e,t,{x:n,y:r}){const{xMin:a,yMin:c,yOffset:i,xOffset:l}=Ne(e,t,n,r);return{x1:a-l+(Math.max(e,n)-a)*.25,y1:c-i+(Math.max(t,r)-c)*.25,x2:a-l+(Math.max(e,n)-a)*.75,y2:c-i+(Math.max(t,r)-c)*.75}}function bt(e,t,{x:n,y:r}){const{xMin:a,yMin:c,yOffset:i,xOffset:l}=Ne(e,t,n,r);return{x1:a-l+(Math.max(e,n)-a)*.5,y1:c-i+(Math.max(t,r)-c)*.5}}const Pe=document.getElementById("arc-cmd-config"),Re=document.getElementById("commands"),p=document.getElementsByClassName("control-point"),$=document.getElementById("control-point-container"),Ct=document.getElementById("download-btn"),x=document.getElementById("drawing-content"),W=document.getElementById("fill-and-stroke"),{elements:ze}=W,L=x.children,w=document.getElementById("layer-select"),P=document.getElementsByName("layer-selector"),Ve=document.getElementById("output-configuration"),_e=document.getElementById("modes"),Ge=document.getElementById("preview"),ee=document.getElementById("close-path-toggle"),Fe=document.getElementById("redo-btn"),y=document.getElementById("canvas"),te=document.getElementById("transformations"),ne=te.elements,Lt=ne.rotate.getElementsByTagName("input"),wt=ne.scale.getElementsByTagName("input"),pe=$.getElementsByTagName("line"),[_]=document.getElementsByName("transform-layer-only"),Ue=document.getElementById("undo-btn"),He=document.getElementById("no-layer-msg").style,X=Object.freeze(Object.keys(Ae)),R=Object.freeze({scale:wt,rotate:Lt}),u=Object.freeze({mode:"path",closePath:!1,outputConfig:Object.freeze({width:"320",height:"180","vb-min-x":"0","vb-min-y":"0","vb-width":"0","vb-height":"0",ratio:"xMidYMid","slice-or-meet":"meet","file-format":"svg"}),transforms:Object.freeze({translate:Object.freeze([0,0]),scale:Object.freeze(["1","1"]),rotate:Object.freeze(["0","0","0"]),skewX:"0",skewY:"0"}),style:Object.freeze({stroke:"#000","stroke-opacity":"1","stroke-width":"2",fill:"#000","fill-opacity":"0","stroke-linecap":"butt","stroke-linejoin":"arcs","stroke-miterlimit":"1","fill-rule":"evenodd"}),styleRelevancies:Object.freeze({"stroke-linecap":"path","stroke-linejoin":"path,rect","stroke-miterlimit":"path,rect","fill-rule":"path"}),arcCmdConfig:Object.freeze({xR:"50",yR:"50",xRot:"0",large:!1,sweep:!1})}),he=e=>e+1,ve=e=>e-1,Qe=Object.freeze({ArrowUp:Object.freeze({prop:1,cb:ve}),ArrowDown:Object.freeze({prop:1,cb:he}),ArrowLeft:Object.freeze({prop:0,cb:ve}),ArrowRight:Object.freeze({prop:0,cb:he})}),xt=5,Et=["checked","textContent","data","onpointerdown","onpointerup"],St=y.createSVGPoint();function E(e,t){const n=z(e.transforms),r=[x,$],a=[n];if(t.activeSVGElement){const c=z(t.activeLayer.transforms);r.push(t.activeSVGElement),a.push(n+c,c)}else a.push(n);r.forEach((c,i)=>c.setAttribute("transform",a[i]))}function v(e){if(typeof e!="object"||e===null)return e;const t=Array.isArray(e)?[]:{};return Object.keys(e).forEach(n=>{t[n]=v(e[n])}),t}function j(e){return t=>g(e.cloneNode(!1),t)}function g(e,t){return Object.keys(t).forEach(n=>{Et.includes(n)?e[n]=t[n]:e.setAttribute(n,t[n])}),e}function be(e,t){return n=>{const[r,a]=A(n);g(e,t(r,a))}}function qe(e){return e.slice().reverse().find(t=>t.cmd==="A")}function Ye(e){return Ke(e).reduce((t,n)=>({...t,[n]:ze[n].value}),Object.create(null))}function Ot(e){return Ke(e).reduce((t,n)=>({...t,[n]:u.style[n]}),Object.create(null))}function Ke(e){return Object.keys(u.style).filter(t=>!u.styleRelevancies[t]||u.styleRelevancies[t].includes(e))}function A({x:e,y:t}){const{x:n,y:r}=Object.assign(St,{x:e,y:t}).matrixTransform(y.children[1].getScreenCTM().inverse());return[n,r]}function I(e){return e[h(e)]}function h(e){return e.length-1}function Xe(e){return`${e.cmd}${Ae[e.cmd](e)}`}function z(e){return Object.entries(e).reduce((t,[n,r])=>`${t}${n}(${typeof r=="object"?r.filter(a=>a!==""):r})`,"")}const D=document.getElementById("coords"),It=e=>{const[t,n]=A(e);D.textContent=`x: ${Math.trunc(t)}, y: ${Math.trunc(n)}`,D.style.left=`${e.pageX-120}px`,D.style.top=`${e.pageY-40}px`};y.addEventListener("pointermove",It),y.addEventListener("pointerleave",()=>{D.style=null});(()=>{const e=document.getElementById("tab-links"),t=[...e.children],n=[{id:"drawing",element:document.querySelector('[data-tab="drawing"]')},{id:"output",element:document.querySelector('[data-tab="output"]')}];e.onclick=({target:r})=>{!r.classList.contains("tab-link")||(t.forEach(a=>a.classList.remove("active")),r.classList.add("active"),n.forEach(a=>a.element.classList.remove("active")),n.find(({id:a})=>a===r.dataset.tabName).element.classList.add("active"))}})();const{elements:Mt}=Ve,Ze=(e,t)=>{e.previousElementSibling.dataset.value=` (${t})`},V=(e,t)=>{e.value=t,e.type==="range"&&Ze(e,t)},Je=(e,t)=>{Object.entries(t).forEach(([n,r])=>{V(e[n],r)})};[...document.querySelectorAll('input[type="range"]')].forEach(e=>{e.addEventListener("input",({target:t})=>{Ze(t,t.value)})});window.onsubmit=e=>e.preventDefault();function We(e){if(e.mode!=="path")return;const t=e.activeLayer&&qe(e.activeLayer.points)||e.arcCmdConfig;Object.assign(e.arcCmdConfig,t),Object.entries(t).filter(([n])=>!["cmd","x","y"].includes(n)).forEach(([n,r])=>{const a=Pe.elements[n];a.type==="checkbox"?a.checked=r:V(a,r)})}function et(e){!e.activeLayer||e.activeLayer.mode!=="path"||(e.cmd=e.activeLayer.points.length?I(e.activeLayer.points).cmd:"M")}function re(e){Je(ze,e)}function tt({outputConfig:e}){Je(Mt,e)}function T(e){Object.entries(e).filter(([t])=>t!=="translate").forEach(([t,n])=>{R[t]?n.forEach((r,a)=>V(R[t][a],r)):V(ne[t],n)})}var kt=(e,t)=>{const n=[v(e)];let r=0;document.addEventListener("DOMContentLoaded",f,{once:!0});function a(O){r<h(n)&&(n.length=r+1),n.push(O),r=h(n),f()}function c(){return n[r]}function i(){r<h(n)&&(r+=1,l(),f())}function l(){const{layers:O,transforms:F}=c();Object.assign(e,{layers:v(O),transforms:v(F)}),t(),document.dispatchEvent(new Event("initializeCanvas"))}function f(){Ue.disabled=r===0,Fe.disabled=r===h(n)}function S(){n.length>1&&r>0&&(r-=1,l(),f())}return{createBackup:a,redo:i,undo:S}};const Bt=/ data-layer-id="\d+"/g,Tt=/\s{2,}/g,H=JSON.parse(window.localStorage.getItem("drawing"))||{},s={layers:H.layers||[],outputConfig:H.outputConfig||{...u.outputConfig},transforms:H.transforms||v(u.transforms)},nt=()=>window.localStorage.setItem("drawing",JSON.stringify(s)),{createBackup:$t,redo:rt,undo:ot}=kt(s,nt);function oe(){return[s.outputConfig["vb-min-x"],s.outputConfig["vb-min-y"],s.outputConfig["vb-width"],s.outputConfig["vb-height"]]}function at(){const{x:e,y:t,width:n,height:r}=x.getBBox();Object.assign(s.outputConfig,{"vb-min-x":Math.trunc(e).toString(),"vb-min-y":Math.trunc(t).toString(),"vb-width":Math.trunc(n).toString(),"vb-height":Math.trunc(r).toString()}),st(),tt(s),d("centerVB")}function ae(){return`<svg xmlns="http://www.w3.org/2000/svg" 
    width="${s.outputConfig.width}" 
    height="${s.outputConfig.height}" 
    viewBox="${oe()}" 
    preserveAspectRatio="${`${s.outputConfig.ratio} ${s.outputConfig["slice-or-meet"]}`}">
    <g transform="${z(s.transforms)}">${x.innerHTML}</g></svg>`.replace(Bt,"").replace(Tt," ")}function ct(){return`data:image/svg+xml,${ae().replace(/"/g,"'")}`.replace(/#/g,"%23")}function d(e){$t({layers:v(s.layers),transforms:v(s.transforms)}),console.log(e),nt()}function jt(){Ge.innerHTML=ae(),oe().every(e=>e===0)&&at()}function st(){g(Ge.firstElementChild,{width:s.outputConfig.width,height:s.outputConfig.height,viewBox:oe(),preserveAspectRatio:`${s.outputConfig.ratio} ${s.outputConfig["slice-or-meet"]}`})}const Ce={rect:(e,t)=>(n,r)=>({x:Math.min(e,n),y:Math.min(t,r),width:Math.abs(e-n),height:Math.abs(t-r)}),ellipse:(e,t)=>(n,r)=>({rx:Math.abs(e-n),ry:Math.abs(t-r)})};var ce={rect:Q((e,t,n,r)=>{if(t[0])return;const a=e.activeSVGElement;t.push({x:n,y:r}),g(a,t[0]),e.drawingShape=!0,Object.assign(e.shapeStart,{x:n,y:r}),y.onpointermove=be(a,Ce.rect(n,r))},({points:[e]})=>({x:e.x,y:e.y,width:e.width||0,height:e.height||0})),ellipse:Q((e,t,n,r)=>{if(t[0])return;const a=e.activeSVGElement;t.push({cx:n,cy:r}),g(a,t[0]),e.drawingShape=!0,Object.assign(e.shapeStart,{x:n,y:r}),y.onpointermove=be(a,Ce.ellipse(n,r))},({points:[e]})=>({cx:e.cx,cy:e.cy,rx:e.rx||0,ry:e.ry||0})),path:Q((e,t,n,r,a,c)=>{const i=I(t);if(i&&n===i.x&&r===i.y)return;t.length||(e.cmd="M"),i&&i.cmd===e.cmd&&["M","V","H"].includes(e.cmd)&&c(t.pop().cmd),t.push({cmd:e.cmd,x:n,y:r});const l=(f=>{switch(f){case"Q":case"S":return bt(n,r,t[t.length-2]);case"C":return vt(n,r,t[t.length-2]);case"A":return De(e.arcCmdConfig);default:return{}}})(e.cmd);Object.assign(I(t),l),a(e.activeLayer,e.layerId)(I(t),h(t))},({points:e,closePath:t})=>({d:`${e.map(Xe).join("")} ${t?"Z":""}`}))};function Q(e,t){return{mkPoint:e,geometryProps:t}}function N(e,t=L[e],n=s.layers[e]){g(t,ce[n.mode].geometryProps(n))}function At(e,t,n){return Object.assign(Object.create(null),{mode:e,points:[],style:t,transforms:n})}function se(e=0,t=w.childElementCount){for(let n=e;n<t;n+=1){const r=L[n],a=w.children[n],[c,i]=a.children;r.dataset.layerId=n,a.dataset.layerId=n,c.textContent=s.layers[n].label||`Layer ${n+1}`,i.value=n}}function it(e,t=s.layers[e].style){g(L[e],t)}const B="http://www.w3.org/2000/svg",Nt=(()=>{const e=g(document.createElement("label"),{draggable:!0}),t=g(document.createElement("span"),{contenteditable:!0}),n=g(document.createElement("input"),{type:"radio",name:"layer-selector"});return e.append(t,n),e})(),ie={path:document.createElementNS(B,"path"),rect:document.createElementNS(B,"rect"),ellipse:document.createElementNS(B,"ellipse")},Dt=document.createElementNS(B,"line"),Pt=g(document.createElementNS(B,"circle"),{r:3}),Le=document.createElement("a"),q=document.createElement("img"),lt=document.createElement("canvas"),we=({x:e,y:t})=>({x:e,y:t}),M=(e,t)=>({cx:e,cy:t}),Z=e=>({cx:e}),J=(e,t)=>({cy:t}),Rt={M:1,L:1,H:1,V:1,Q:2,C:3,A:1,S:2,T:1},xe=(e,t)=>e.points.slice(0,t).reduce((n,r)=>n+Rt[r.cmd],0),Y=(e,t)=>{const n=[];if(e.points[t+1]){const{cmd:r}=e.points[t+1];r==="V"?n.push(m(p[xe(e,t+1)],Z)):r==="H"&&n.push(m(p[xe(e,t+1)],J))}return n};var zt={regularPoint:b(we,"control-point__regular",(e,t,n)=>{const r=Y(t,n);return[m(e,M),...r]}),hCmd:b(({x:e})=>({x:e}),"control-point__h",(e,t,n)=>{const r=Y(t,n);return[m(e,Z),...r]}),vCmd:b(({y:e})=>({y:e}),"control-point__v",(e,t,n)=>{const r=Y(t,n);return[m(e,J),...r]}),firstControlPoint:b(({x:e,y:t})=>({x1:e,y1:t}),"control-point__a",e=>[m(e,M)]),secondControlPoint:b(({x:e,y:t})=>({x2:e,y2:t}),"control-point__b",e=>[m(e,M)]),rectTopLeft:b(we,"control-point__rect-top-left",(e,t,n)=>{const r=t.points[n];return[m(e,M),m(p[1],(a,c)=>({cx:a+r.width,cy:c+r.height}))]}),rectLowerRight:b(({x:e,y:t},n)=>({width:e>n.x?e-n.x:n.width,height:t>n.y?t-n.y:n.height}),"control-point__rect-bottom-right",(e,t,n)=>{const r=t.points[n];return[m(e,(a,c)=>{const i=a<r.x?r.x:a,l=c<r.y?r.y:c;return{cx:i,cy:l}})]}),ellipseCenter:b(({x:e,y:t})=>({cx:e,cy:t}),"control-point__ellipse-center",(e,t,n)=>{const r=t.points[n];return[m(e,M),m(p[1],()=>({cx:r.cx-r.rx,cy:r.cy})),m(p[2],()=>({cx:r.cx,cy:r.cy-r.ry}))]}),rx:b(({x:e},t)=>({rx:Math.abs(e-t.cx)}),"control-point__ellipse-rx",e=>[m(e,Z)]),ry:b(({y:e},t)=>({ry:Math.abs(e-t.cy)}),"control-point__ellipse-ry",e=>[m(e,J)])};function b(e,t,n){return{changeData:e,CSSClass:t,getAffectedPoints:n}}function m(e,t){return{ref:e,fx:t}}const{regularPoint:Vt,hCmd:_t,vCmd:Gt,firstControlPoint:Ft,secondControlPoint:Ut,rectTopLeft:Ht,rectLowerRight:Qt,ellipseCenter:qt,rx:Yt,ry:Kt}=zt,Ee=()=>{Object.assign(y,{onpointermove:null,onpointerleave:null,onpointerup:null}),d("dragging")},Xt=(e,t,n)=>r=>{r.stopPropagation(),Object.assign(y,{onpointermove:Zt(e,t,n,r.target),onpointerleave:Ee,onpointerup:Ee})},Se={attributes:!0,attributeFilter:["cx","cy"]},K=(e,t,n,r,a,c)=>{const i=j(Dt)({x1:e,y1:t,x2:n,y2:r}),l=new MutationObserver(()=>{i.setAttribute("x1",a.getAttribute("cx")),i.setAttribute("y1",a.getAttribute("cy"))}),f=new MutationObserver(()=>{i.setAttribute("x2",c.getAttribute("cx")),i.setAttribute("y2",c.getAttribute("cy"))});return l.observe(a,Se),f.observe(c,Se),i};function C(e,t,n,r,a){return j(Pt)({class:`control-point ${r.CSSClass}`,cx:e,cy:t,onpointerdown:Xt(a,n,r)})}function Zt(e,t,n,r){const a=s.layers[e],c=a.points[t],{changeData:i}=n,l=n.getAffectedPoints(r,a,t);return f=>{const[S,O]=A(f);Object.assign(c,i({x:S,y:O},c)),N(e),l.forEach(({ref:F,fx:pt})=>g(F,pt(S,O)))}}function le(e,t){return(n,r)=>{const a=[];if("cmd"in n)if(["M","L","Q","C","A","S","T"].includes(n.cmd)){const c=C(n.x,n.y,r,Vt,t);if(["Q","C","S"].includes(n.cmd)){const i=e.points[r-1],l=C(n.x1,n.y1,r,Ft,t);if(a.push(l),n.cmd!=="S"&&a.push(K(n.x1,n.y1,i.x,i.y,l,I(p))),n.cmd==="C"){const f=C(n.x2,n.y2,r,Ut,t);a.push(f,K(n.x,n.y,n.x2,n.y2,c,f))}["Q","S"].includes(n.cmd)&&a.push(K(n.x,n.y,n.x1,n.y1,c,l))}a.push(c)}else n.cmd==="H"?a.push(C(n.x,e.points[r-1].y,r,_t,t)):n.cmd==="V"&&a.push(C(e.points[r-1].x,n.y,r,Gt,t));else"width"in n?a.push(C(n.x,n.y,r,Ht,t),C(n.x+n.width,n.y+n.height,r,Qt,t)):"cx"in n&&a.push(C(n.cx,n.cy,r,qt,t),C(n.cx-n.rx,n.cy,r,Yt,t),C(n.cx,n.cy-n.ry,r,Kt,t));$.append(...a)}}function dt(e){if(p[h(p)].remove(),["Q","C","S"].includes(e)){const t=e==="S"?1:2;for(let n=0;n<t;n+=1)pe[h(pe)].remove();p[h(p)].remove(),e==="C"&&p[h(p)].remove()}}function G(){[...$.children].forEach(e=>{e.remove()})}const Jt=Object.keys(ce),Oe=e=>typeof e=="boolean";let Ie,Me=!1,ke,Be,Te=!1;const o={arcCmdConfig:{...u.arcCmdConfig},get activeLayer(){return s.layers[o.layerId]},get activeSVGElement(){return L[o.layerId]},get cmd(){return Ie},set cmd(e){const t=X.includes(e)?e:X[0];Ie=t,Re.value=t},get drawingShape(){return Me},set drawingShape(e){Oe(e)&&(Me=e)},get layerId(){return ke},set layerId(e){if(e===void 0&&s.layers.length===0||!Number.isNaN(Number(e))&&e>=0&&e<s.layers.length){if(ke=Number(e),e===void 0)return;E(s,o),G(),de(),et(o),We(o),re(s.layers[e].style),ee.checked=o.activeLayer.closePath,_.checked&&T(s.layers[e].transforms)}},get mode(){return Be},set mode(e){Jt.includes(e)&&(Be=e,_e.modes.value=e,document.body.dataset.mode=e)},shapeStart:{},get transformLayerNotDrawing(){return Te},set transformLayerNotDrawing(e){Oe(e)&&(Te=e)},get transformTarget(){return(o.transformLayerNotDrawing?o.activeLayer:s).transforms}};document.addEventListener("initializeCanvas",fe);window.addEventListener("DOMContentLoaded",()=>{var e;Object.assign(o,{cmd:"M",layerId:s.layers.length?0:void 0,mode:((e=s.layers[0])==null?void 0:e.mode)||u.mode}),fe()},{once:!0});const Wt=e=>{e.dataTransfer.setData("text",e.target.dataset.layerId),e.dataTransfer.effectAllowed="move"},en=({target:e})=>{o.activeLayer.label=e.textContent.replace(/\n/g,/\s/).trim(),d("changeLabel")};function de(){!o.activeLayer||o.activeLayer.points.forEach(le(o.activeLayer,o.layerId))}function ue(e=w.childElementCount){const t=Nt.cloneNode(!0),[n,r]=t.children;t.dataset.layerId=e,t.ondragstart=Wt,n.oninput=en,g(n,{textContent:s.layers[e]&&s.layers[e].label||`Layer ${e+1}`}),g(r,{value:e,checked:o.layerId===P.length}),w.append(t),se(e),He.display="none"}function ut(){const e=L.length;for(He.display=e?"none":"initial";w.childElementCount!==e;)w.lastChild.remove();e===0?o.layerId=void 0:o.layerId===e?o.layerId-=1:(o.layerId===void 0&&(o.layerId=0),E(s,o),se(o.layerId),re(o.activeLayer.style),de(),o.mode=o.activeLayer.mode),P[o.layerId]&&(P[o.layerId].checked=!0)}function fe(){var e;G(),[...L].forEach(t=>t.remove()),ut(),de(),x.append(...s.layers.map((t,n)=>{const r=ie[t.mode],a=t.mode==="path"?{d:`${t.points.map(Xe).join(" ")}${t.closePath?"Z":""}`}:t.points[0]||{};return j(r)({"data-layer-id":n,...t.style,...a,transform:z(t.transforms)})})),s.layers.forEach((t,n)=>ue(n)),ee.checked=o.activeLayer&&o.activeLayer.closePath,et(o),E(s,o),T(o.transformTarget),_.checked=o.transformLayerNotDrawing,re(((e=o.activeLayer)==null?void 0:e.style)||u.style),We(o),tt(s)}const tn=["data-layer-id","transform"],k=lt.getContext("2d"),$e=e=>{Object.assign(Le,{download:`My_SVG.${s.outputConfig["file-format"]}`,href:e}),Le.click()},ft=e=>window.navigator.clipboard.writeText(e),je={C:gt,Z:ot,Y:rt};window.onkeyup=({key:e})=>{Qe[e]&&d("keyup")};te.onchange=()=>d("setTransform");function me(){s.layers.push(At(o.mode,(o.activeLayer?Ot:Ye)(o.mode),v(u.transforms))),o.layerId=h(s.layers),x.append(j(ie[o.mode])({"data-layer-id":o.layerId})),ue(o.layerId)}function nn(e){o.activeLayer||me();const[t,n]=A(e),{points:r}=o.activeLayer;ce[o.mode].mkPoint(o,r,t,n,le,dt),o.mode==="path"&&$.lastElementChild.dispatchEvent(new Event("pointerdown")),it(o.layerId),N(o.layerId)}function rn(){const e=o.transformLayerNotDrawing?[o.activeSVGElement,o.activeLayer.transforms]:[y.firstElementChild,s.transforms];yn(...e),E(s,o)}function on({deltaY:e}){const t=Number(document.documentElement.style.getPropertyValue("--bg-grid-size").replace("px","")||40),n=e<0?-1:1;n===-1&&t===10||n===1&&t===80||document.documentElement.style.setProperty("--bg-grid-size",`${t+xt*n}px`)}function an(){Object.assign(s,{layers:[],outputConfig:{...u.outputConfig},transforms:v(u.transforms)}),fe(),d("clear")}function cn({target:e}){if(o.arcCmdConfig[e.name]=e[e.type==="checkbox"?"checked":"value"],!o.activeLayer)return;const t=qe(o.activeLayer.points);!t||(Object.assign(t,De(o.arcCmdConfig)),N(o.layerId),d("configArcCmd"))}function sn({target:{name:e,value:t}}){s.outputConfig[e]=t,st(),d("configOutput")}function ln(){ft(ct())}function dn(){ft(ae())}function mt(){var t;if(!((t=o.activeLayer)!=null&&t.points.length))return;const e=o.activeLayer.points.pop();if(d("deleteLastPoint"),e.cmd)dt(e.cmd),N(o.layerId);else{const n=o.activeSVGElement;G(),n.getAttributeNames().filter(r=>!tn.includes(r)).forEach(r=>n.removeAttribute(r))}}function un(){!L.length||(s.layers.splice(o.layerId,1),o.activeSVGElement.remove(),G(),ut(),d("deleteLayer"),o.mode=o.activeLayer.mode)}function gt(){s.layers.splice(o.layerId,0,v(o.activeLayer)),o.activeSVGElement.after(o.activeSVGElement.cloneNode(!0)),o.layerId+=1,ue(o.layerId),d("ctrl+c")}function yt(e){if(!o.drawingShape)return;o.drawingShape=!1;const[t,n]=A(e),{points:r=[]}=o.activeLayer,a={hor:Math.abs(o.shapeStart.x-t),vert:Math.abs(o.shapeStart.y-n)};Object.assign(r[0],o.mode==="rect"?{x:Math.min(o.shapeStart.x,t),y:Math.min(o.shapeStart.y,n),width:a.hor,height:a.vert}:{rx:a.hor,ry:a.vert}),d("drawShape"),le(o.activeLayer,o.layerId)(I(r),h(r)),y.onpointermove=null}function fn(e){const{key:t}=e;if(t==="F12"||(t==="Enter"&&e.target.contentEditable&&e.target.blur(),document.activeElement!==document.body))return;const n=Qe[t];if(e.ctrlKey&&je[t.toUpperCase()])je[t.toUpperCase()]();else if(n){if(!o.activeLayer&&!e.ctrlKey)return;const{transforms:{translate:r}}=e.ctrlKey?s:o.activeLayer,{cb:a,prop:c}=n;r[c]=a(+r[c]),E(s,o)}else t==="Backspace"?mt():X.includes(t.toUpperCase())&&(o.cmd=t.toUpperCase());e.preventDefault()}function mn(e){const n=+e.target.closest("label").dataset.layerId,r=L[n],a=+e.dataTransfer.getData("text"),c=L[a],[i]=s.layers.splice(a,1);s.layers.splice(n,0,i),d("reorderLayer"),a<n?r.after(c):x.insertBefore(c,r),a!==o.layerId?a>o.layerId&&n<=o.layerId?o.layerId+=1:a<o.layerId&&n>o.layerId&&(o.layerId-=1):o.layerId=n,se(Math.min(a,n),Math.max(a,n)+1),P[o.layerId].checked=!0,e.preventDefault()}function gn(){const{transforms:e}=u;_.checked&&o.activeLayer?o.activeLayer.transforms=v(e):s.transforms=v(e),E(s,o),T(e),d("resetTransforms")}function yn(e,t){const{x:n,y:r,width:a,height:c}=e.getBBox(),i=[Math.trunc(n+a*.5),Math.trunc(r+c*.5)];[R.rotate[1].value,R.rotate[2].value]=i,[t.rotate[1],t.rotate[2]]=i,d("setCenterofRotation")}function pn({target:{value:e}}){o.cmd=e}function hn({target:{name:e,value:t}}){!o.activeLayer||(o.activeLayer.style[e]=t,e==="fill"&&o.activeLayer.style["fill-opacity"]==="0"&&(o.activeLayer.style["fill-opacity"]="1"),it(o.layerId))}W.onchange=()=>d("setFillOrStroke");function vn({target:{value:e}}){const t=+e;o.mode=s.layers[t].mode,o.layerId=t}function bn({target:{value:e},currentTarget:t}){if(o.drawingShape){t.modes.value=o.mode;return}if(o.mode=e,!!o.activeLayer)if(o.activeLayer.points.length)me();else{o.activeLayer.mode=o.mode;const n=j(ie[o.mode])({"data-layer-id":o.layerId}),r=o.activeSVGElement;r.replaceWith(n),r.remove(),Object.keys(o.activeLayer.style).forEach(a=>{a in u.styleRelevancies&&!u.styleRelevancies[a].includes(o.mode)&&delete o.activeLayer.style[a]}),Object.assign(o.activeLayer.style,Ye(o.mode)),d("setMode")}}function Cn({target:{classList:e,dataset:t,name:n,value:r}}){if(e.contains("transform-config")){const{transform:a,id:c}=t;o.transformTarget[a][+c]=r}else o.transformTarget[n]=r;E(s,o)}function Ln({target:{checked:e}}){T(e?o.activeLayer?o.activeLayer.transforms:u.transforms:s.transforms),o.transformLayerNotDrawing=e}function wn({target:e}){!o.activeLayer||(o.activeLayer.closePath=e.checked,N(o.layerId),d("togglePathClosing"))}function xn(){const e=ct();s.outputConfig["file-format"]==="svg"?$e(e):(q.src=e,q.onload=()=>{k.clearRect(0,0,k.canvas.width,k.canvas.height),Object.assign(k.canvas,{width:s.outputConfig.width,height:s.outputConfig.height}),k.drawImage(q,0,0),$e(lt.toDataURL())})}Pe.oninput=cn;Re.onchange=pn;document.getElementById("reset-transforms").onclick=gn;document.getElementById("get-markup").onclick=dn;document.getElementById("get-data-uri").onclick=ln;document.getElementById("center-rotation-btn").onclick=rn;document.getElementById("center-vb").onclick=at;document.getElementById("add-layer").onclick=me;document.getElementById("del-layer").onclick=un;document.getElementById("clear-all").onclick=an;document.getElementById("del-last-point").onclick=mt;document.getElementById("duplicate-layer").onclick=gt;document.querySelector('a[data-tab-name="output"]').onclick=jt;Ct.onclick=xn;W.oninput=hn;w.onchange=vn;w.ondrop=mn;_e.onchange=bn;Ve.oninput=sn;ee.onchange=wn;Fe.addEventListener("click",rt);y.addEventListener("pointerdown",nn);y.onwheel=on;y.addEventListener("pointerleave",yt);document.addEventListener("pointerup",yt);te.oninput=Cn;_.onchange=Ln;Ue.addEventListener("click",ot);window.onkeydown=fn;
