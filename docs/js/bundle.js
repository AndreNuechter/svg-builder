(()=>{var xn=(()=>window.addEventListener("load",()=>{let e=({target:{parentElement:t}})=>{t.classList.toggle("closed"),t.classList.toggle("open")};[...document.getElementsByClassName("togglable")].forEach(t=>{t.firstElementChild.onclick=e,!t.classList.contains("open")&&!t.classList.contains("closed")&&t.classList.add("closed")})},{once:!0}))();var we=({x:e,y:t})=>`${e} ${t}`,Z={H:({x:e})=>e,V:({y:e})=>e,Q:({x:e,x1:t,y:n,y1:r})=>`${t} ${r} ${e} ${n}`,C:({x:e,x1:t,x2:n,y:r,y1:a,y2:s})=>`${t} ${a} ${n} ${s} ${e} ${r}`,A:({x:e,xR:t,xRot:n,y:r,yR:a,large:s,sweep:c})=>`${t} ${a} ${n} ${s} ${c} ${e} ${r}`,S:({x:e,x1:t,y:n,y1:r})=>`${t} ${r} ${e} ${n}`,T:we,M:we,L:we},Ke=33,qe=(e,t,n,r)=>e<t?n>r?-Ke:Ke:0,Xe=(e,t,n,r)=>{let a=Math.abs(n-e),s=Math.abs(r-t),c=Math.min(e,n),d=Math.min(t,r),h=qe(s,a,n,e),A=qe(a,s,r,t);return{xMin:c,yMin:d,yOffset:h,xOffset:A}};function J(e){return{xR:e.xR,yR:e.yR,xRot:e.xRot,large:+e.large,sweep:+e.sweep}}function Ze(e,t,{x:n,y:r}){let{xMin:a,yMin:s,yOffset:c,xOffset:d}=Xe(e,t,n,r);return{x1:a-d+(Math.max(e,n)-a)*.25,y1:s-c+(Math.max(t,r)-s)*.25,x2:a-d+(Math.max(e,n)-a)*.75,y2:s-c+(Math.max(t,r)-s)*.75}}function Je(e,t,{x:n,y:r}){let{xMin:a,yMin:s,yOffset:c,xOffset:d}=Xe(e,t,n,r);return{x1:a-d+(Math.max(e,n)-a)*.5,y1:s-c+(Math.max(t,r)-s)*.5}}var W=document.getElementById("arc-cmd-config"),ee=document.getElementById("commands"),b=document.getElementsByClassName("control-point"),T=document.getElementById("control-point-container"),We=document.getElementById("download-btn"),x=document.getElementById("drawing-content"),z=document.getElementById("fill-and-stroke"),{elements:te}=z,w=x.children,L=document.getElementById("layer-select"),D=document.getElementsByName("layer-selector"),ne=document.getElementById("output-configuration"),re=document.getElementById("modes"),xe=document.getElementById("preview"),_=document.getElementById("close-path-toggle"),oe=document.getElementById("redo-btn"),p=document.getElementById("canvas"),G=document.getElementById("transformations"),ae=G.elements,et=ae.rotate.getElementsByTagName("input"),tt=ae.scale.getElementsByTagName("input"),Le=T.getElementsByTagName("line"),[M]=document.getElementsByName("transform-layer-only"),se=document.getElementById("undo-btn"),Se=document.getElementById("no-layer-msg").style;var U=Object.freeze(Object.keys(Z)),R=Object.freeze({scale:tt,rotate:et}),f=Object.freeze({mode:"path",closePath:!1,outputConfig:Object.freeze({width:"320",height:"180","vb-min-x":"0","vb-min-y":"0","vb-width":"0","vb-height":"0",ratio:"xMidYMid","slice-or-meet":"meet","file-format":"svg"}),transforms:Object.freeze({translate:Object.freeze([0,0]),scale:Object.freeze(["1","1"]),rotate:Object.freeze(["0","0","0"]),skewX:"0",skewY:"0"}),style:Object.freeze({stroke:"#000","stroke-opacity":"1","stroke-width":"2",fill:"#000","fill-opacity":"0","stroke-linecap":"butt","stroke-linejoin":"arcs","stroke-miterlimit":"1","fill-rule":"evenodd"}),styleRelevancies:Object.freeze({"stroke-linecap":"path","stroke-linejoin":"path,rect","stroke-miterlimit":"path,rect","fill-rule":"path"}),arcCmdConfig:Object.freeze({xR:"50",yR:"50",xRot:"0",large:!1,sweep:!1})}),nt=e=>e+1,rt=e=>e-1,je=Object.freeze({ArrowUp:Object.freeze({prop:1,cb:rt}),ArrowDown:Object.freeze({prop:1,cb:nt}),ArrowLeft:Object.freeze({prop:0,cb:rt}),ArrowRight:Object.freeze({prop:0,cb:nt})});var qt=["checked","textContent","data","onpointerdown","onpointerup"],Xt=p.createSVGPoint();function O(e,t){let n=N(e.transforms),r=[x,T],a=[n];if(t.activeSVGElement){let s=N(t.activeLayer.transforms);r.push(t.activeSVGElement),a.push(n+s,s)}else a.push(n);r.forEach((s,c)=>s.setAttribute("transform",a[c]))}function C(e){if(typeof e!="object"||e===null)return e;let t=Array.isArray(e)?[]:{};return Object.keys(e).forEach(n=>{t[n]=C(e[n])}),t}function I(e){return t=>u(e.cloneNode(!1),t)}function u(e,t){return Object.keys(t).forEach(n=>{qt.includes(n)?e[n]=t[n]:e.setAttribute(n,t[n])}),e}function Ee(e,t){return n=>{let[r,a]=k(n);u(e,t(r,a))}}function ce(e){return e.slice().reverse().find(t=>t.cmd==="A")}function Oe(e){return ot(e).reduce((t,n)=>({...t,[n]:te[n].value}),Object.create(null))}function at(e){return ot(e).reduce((t,n)=>({...t,[n]:f.style[n]}),Object.create(null))}function ot(e){return Object.keys(f.style).filter(t=>!f.styleRelevancies[t]||f.styleRelevancies[t].includes(e))}function k({x:e,y:t}){let{x:n,y:r}=Object.assign(Xt,{x:e,y:t}).matrixTransform(p.children[1].getScreenCTM().inverse());return[n,r]}function S(e){return e[y(e)]}function y(e){return e.length-1}function ie(e){return`${e.cmd}${Z[e.cmd](e)}`}function N(e){return Object.entries(e).reduce((t,[n,r])=>`${t}${n}(${typeof r=="object"?r.filter(a=>a!==""):r})`,"")}var le=document.getElementById("coords"),Zt=e=>{let[t,n]=k(e);le.textContent=`x: ${Math.trunc(t)}, y: ${Math.trunc(n)}`,le.style.left=`${e.pageX-120}px`,le.style.top=`${e.pageY-40}px`},Pn=(()=>{p.addEventListener("pointermove",Zt),p.addEventListener("pointerleave",()=>{le.style=null})})();var Rn=(()=>{let{body:e}=document,t=document.getElementById("tabs"),n=[...t.children],r=["drawing","output"],a=()=>{let s=window.location.hash.slice(1),c=r.includes(s)?s:r[0];e.dataset.activeTab=c,document.querySelector(`a[data-tab-name="${c}"]`).click(),c!==s&&(window.location.hash=c)};window.addEventListener("DOMContentLoaded",a,{once:!0}),window.onhashchange=a,t.onclick=({target:s})=>{!s.classList.contains("tab")||(e.dataset.activeTab=s.dataset.tabName,n.forEach(c=>c.classList.remove("active")),s.classList.add("active"))}})();var{elements:Jt}=ne,st=(e,t)=>{Object.entries(t).forEach(([n,r])=>{e[n].value=r})};window.onsubmit=e=>e.preventDefault();function Te(e){if(e.mode!=="path")return;let t=e.activeLayer&&ce(e.activeLayer.points)||e.arcCmdConfig;Object.assign(e.arcCmdConfig,t),Object.entries(t).filter(([n])=>!["cmd","x","y"].includes(n)).forEach(([n,r])=>{let a=W.elements[n];a[a.type==="checkbox"?"checked":"value"]=r})}function Ie(e){!e.activeLayer||e.activeLayer.mode!=="path"||(e.cmd=e.activeLayer.points.length?S(e.activeLayer.points).cmd:"M")}function de(e){st(te,e)}function me({outputConfig:e}){st(Jt,e)}function B(e){Object.entries(e).filter(([t])=>t!=="translate").forEach(([t,n])=>{R[t]?n.forEach((r,a)=>{R[t][a].value=r}):ae[t].value=n})}var ct=(e,t)=>{let n=[C(e)],r=0;document.addEventListener("DOMContentLoaded",h,{once:!0});function a(P){r<y(n)&&(n.length=r+1),n.push(P),r=y(n),h()}function s(){return n[r]}function c(){r<y(n)&&(r+=1,d(),h())}function d(){let{layers:P,transforms:be}=s();Object.assign(e,{layers:C(P),transforms:C(be)}),t(),document.dispatchEvent(new Event("initializeCanvas"))}function h(){se.disabled=r===0,oe.disabled=r===y(n)}function A(){n.length>1&&r>0&&(r-=1,d(),h())}return{createBackup:a,redo:c,undo:A}};var Wt=/ data-layer-id="\d+"/g,en=/\s{2,}/g,ke=JSON.parse(window.localStorage.getItem("drawing"))||{},g={layers:ke.layers||[],outputConfig:ke.outputConfig||{...f.outputConfig},transforms:ke.transforms||C(f.transforms)},it=()=>window.localStorage.setItem("drawing",JSON.stringify(g)),{createBackup:tn,redo:fe,undo:ue}=ct(g,it),i=g;function Me(){return[g.outputConfig["vb-min-x"],g.outputConfig["vb-min-y"],g.outputConfig["vb-width"],g.outputConfig["vb-height"]]}function ge(){let{x:e,y:t,width:n,height:r}=x.getBBox();Object.assign(g.outputConfig,{"vb-min-x":Math.trunc(e).toString(),"vb-min-y":Math.trunc(t).toString(),"vb-width":Math.trunc(n).toString(),"vb-height":Math.trunc(r).toString()}),Be(),me(g),m("centerVB")}function pe(){return`<svg xmlns="http://www.w3.org/2000/svg" 
    width="${g.outputConfig.width}" 
    height="${g.outputConfig.height}" 
    viewBox="${Me()}" 
    preserveAspectRatio="${`${g.outputConfig.ratio} ${g.outputConfig["slice-or-meet"]}`}">
    <g transform="${N(g.transforms)}">${x.innerHTML}</g></svg>`.replace(Wt,"").replace(en," ")}function $e(){return`data:image/svg+xml,${pe().replace(/"/g,"'")}`.replace(/#/g,"%23")}function m(e){tn({layers:C(g.layers),transforms:C(g.transforms)}),console.log(e),it()}function Ae(){xe.innerHTML=pe(),Me().every(e=>e===0)&&ge()}function Be(){u(xe.firstElementChild,{width:g.outputConfig.width,height:g.outputConfig.height,viewBox:Me(),preserveAspectRatio:`${g.outputConfig.ratio} ${g.outputConfig["slice-or-meet"]}`})}var lt={rect:(e,t)=>(n,r)=>({x:Math.min(e,n),y:Math.min(t,r),width:Math.abs(e-n),height:Math.abs(t-r)}),ellipse:(e,t)=>(n,r)=>({rx:Math.abs(e-n),ry:Math.abs(t-r)})},V={rect:Pe((e,t,n,r)=>{if(t[0])return;let a=e.activeSVGElement;t.push({x:n,y:r}),u(a,t[0]),e.drawingShape=!0,Object.assign(e.shapeStart,{x:n,y:r}),p.onpointermove=Ee(a,lt.rect(n,r))},({points:[e]})=>({x:e.x,y:e.y,width:e.width||0,height:e.height||0})),ellipse:Pe((e,t,n,r)=>{if(t[0])return;let a=e.activeSVGElement;t.push({cx:n,cy:r}),u(a,t[0]),e.drawingShape=!0,Object.assign(e.shapeStart,{x:n,y:r}),p.onpointermove=Ee(a,lt.ellipse(n,r))},({points:[e]})=>({cx:e.cx,cy:e.cy,rx:e.rx||0,ry:e.ry||0})),path:Pe((e,t,n,r,a,s)=>{let c=S(t);if(c&&n===c.x&&r===c.y)return;t.length||(e.cmd="M"),c&&c.cmd===e.cmd&&["M","V","H"].includes(e.cmd)&&s(t.pop().cmd),t.push({cmd:e.cmd,x:n,y:r});let d=(h=>{switch(h){case"Q":case"S":return Je(n,r,t[t.length-2]);case"C":return Ze(n,r,t[t.length-2]);case"A":return J(e.arcCmdConfig);default:return{}}})(e.cmd);Object.assign(S(t),d),a(e.activeLayer,e.layerId)(S(t),y(t))},({points:e,closePath:t})=>({d:`${e.map(ie).join("")} ${t?"Z":""}`}))};function Pe(e,t){return{mkPoint:e,geometryProps:t}}function $(e,t=w[e],n=i.layers[e]){u(t,V[n.mode].geometryProps(n))}function dt(e,t,n){return Object.assign(Object.create(null),{mode:e,points:[],style:t,transforms:n})}function H(e=0,t=L.childElementCount){for(let n=e;n<t;n+=1){let r=w[n],a=L.children[n],[s,c]=a.children;r.dataset.layerId=n,a.dataset.layerId=n,s.textContent=i.layers[n].label||`Layer ${n+1}`,c.value=n}}function De(e,t=i.layers[e].style){u(w[e],t)}var Q="http://www.w3.org/2000/svg",mt=(()=>{let e=u(document.createElement("label"),{draggable:!0}),t=u(document.createElement("span"),{contenteditable:!0}),n=u(document.createElement("input"),{type:"radio",name:"layer-selector"});return e.append(t,n),e})(),Y={path:document.createElementNS(Q,"path"),rect:document.createElementNS(Q,"rect"),ellipse:document.createElementNS(Q,"ellipse")},ft=document.createElementNS(Q,"line"),ut=u(document.createElementNS(Q,"circle"),{r:3}),Re=document.createElement("a"),ye=document.createElement("img"),Ne=document.createElement("canvas");var gt=({x:e,y:t})=>({x:e,y:t}),K=(e,t)=>({cx:e,cy:t}),Ve=e=>({cx:e}),Fe=(e,t)=>({cy:t}),nn={M:1,L:1,H:1,V:1,Q:2,C:3,A:1,S:2,T:1},pt=(e,t)=>e.points.slice(0,t).reduce((n,r)=>n+nn[r.cmd],0),ze=(e,t)=>{let n=[];if(e.points[t+1]){let{cmd:r}=e.points[t+1];r==="V"?n.push(v(b[pt(e,t+1)],Ve)):r==="H"&&n.push(v(b[pt(e,t+1)],Fe))}return n},yt={regularPoint:j(gt,"control-point__regular",(e,t,n)=>{let r=ze(t,n);return[v(e,K),...r]}),hCmd:j(({x:e})=>({x:e}),"control-point__h",(e,t,n)=>{let r=ze(t,n);return[v(e,Ve),...r]}),vCmd:j(({y:e})=>({y:e}),"control-point__v",(e,t,n)=>{let r=ze(t,n);return[v(e,Fe),...r]}),firstControlPoint:j(({x:e,y:t})=>({x1:e,y1:t}),"control-point__a",e=>[v(e,K)]),secondControlPoint:j(({x:e,y:t})=>({x2:e,y2:t}),"control-point__b",e=>[v(e,K)]),rectTopLeft:j(gt,"control-point__rect-top-left",(e,t,n)=>{let r=t.points[n];return[v(e,K),v(b[1],(a,s)=>({cx:a+r.width,cy:s+r.height}))]}),rectLowerRight:j(({x:e,y:t},n)=>({width:e>n.x?e-n.x:n.width,height:t>n.y?t-n.y:n.height}),"control-point__rect-bottom-right",(e,t,n)=>{let r=t.points[n];return[v(e,(a,s)=>{let c=a<r.x?r.x:a,d=s<r.y?r.y:s;return{cx:c,cy:d}})]}),ellipseCenter:j(({x:e,y:t})=>({cx:e,cy:t}),"control-point__ellipse-center",(e,t,n)=>{let r=t.points[n];return[v(e,K),v(b[1],()=>({cx:r.cx-r.rx,cy:r.cy})),v(b[2],()=>({cx:r.cx,cy:r.cy-r.ry}))]}),rx:j(({x:e},t)=>({rx:Math.abs(e-t.cx)}),"control-point__ellipse-rx",e=>[v(e,Ve)]),ry:j(({y:e},t)=>({ry:Math.abs(e-t.cy)}),"control-point__ellipse-ry",e=>[v(e,Fe)])};function j(e,t,n){return{changeData:e,CSSClass:t,getAffectedPoints:n}}function v(e,t){return{ref:e,fx:t}}var{regularPoint:rn,hCmd:on,vCmd:an,firstControlPoint:sn,secondControlPoint:cn,rectTopLeft:ln,rectLowerRight:dn,ellipseCenter:mn,rx:fn,ry:un}=yt,ht=()=>{Object.assign(p,{onpointermove:null,onpointerleave:null,onpointerup:null}),m("dragging")},pn=(e,t,n)=>r=>{r.stopPropagation(),Object.assign(p,{onpointermove:gn(e,t,n,r.target),onpointerleave:ht,onpointerup:ht})},Ct={attributes:!0,attributeFilter:["cx","cy"]},_e=(e,t,n,r,a,s)=>{let c=I(ft)({x1:e,y1:t,x2:n,y2:r}),d=new MutationObserver(()=>{c.setAttribute("x1",a.getAttribute("cx")),c.setAttribute("y1",a.getAttribute("cy"))}),h=new MutationObserver(()=>{c.setAttribute("x2",s.getAttribute("cx")),c.setAttribute("y2",s.getAttribute("cy"))});return d.observe(a,Ct),h.observe(s,Ct),c};function E(e,t,n,r,a){return I(ut)({class:`control-point ${r.CSSClass}`,cx:e,cy:t,onpointerdown:pn(a,n,r)})}function gn(e,t,n,r){let a=i.layers[e],s=a.points[t],{changeData:c}=n,d=n.getAffectedPoints(r,a,t);return h=>{let[A,P]=k(h);Object.assign(s,c({x:A,y:P},s)),$(e),d.forEach(({ref:be,fx:Kt})=>u(be,Kt(A,P)))}}function q(e,t){return(n,r)=>{let a=[];if("cmd"in n){let s=E(n.x,n.y,r,rn,t);if(["M","L","Q","C","A","S","T"].includes(n.cmd)){if(["Q","C","S"].includes(n.cmd)){let c=e.points[r-1],d=E(n.x1,n.y1,r,sn,t);if(a.push(d),n.cmd!=="S"&&a.push(_e(n.x1,n.y1,c.x,c.y,d,S(b))),n.cmd==="C"){let h=E(n.x2,n.y2,r,cn,t);a.push(h,_e(n.x,n.y,n.x2,n.y2,s,h))}["Q","S"].includes(n.cmd)&&a.push(_e(n.x,n.y,n.x1,n.y1,s,d))}}else n.cmd==="H"?a.push(E(n.x,e.points[r-1].y,r,on,t)):n.cmd==="V"&&a.push(E(e.points[r-1].x,n.y,r,an,t));a.push(s)}else"width"in n?a.push(E(n.x,n.y,r,ln,t),E(n.x+n.width,n.y+n.height,r,dn,t)):"cx"in n&&a.push(E(n.cx,n.cy,r,mn,t),E(n.cx-n.rx,n.cy,r,fn,t),E(n.cx,n.cy-n.ry,r,un,t));T.append(...a)}}function Ge(e){if(b[y(b)].remove(),["Q","C","S"].includes(e)){let t=e==="S"?1:2;for(let n=0;n<t;n+=1)Le[y(Le)].remove();b[y(b)].remove(),e==="C"&&b[y(b)].remove()}}function F(){[...T.children].forEach(e=>{e.remove()})}var yn=Object.keys(V),vt=e=>typeof e=="boolean",bt,wt=!1,xt,Lt,St=!1,l={arcCmdConfig:{...f.arcCmdConfig},get activeLayer(){return i.layers[l.layerId]},get activeSVGElement(){return w[l.layerId]},get cmd(){return bt},set cmd(e){let t=U.includes(e)?e:U[0];bt=t,ee.value=t},get drawingShape(){return wt},set drawingShape(e){vt(e)&&(wt=e)},get layerId(){return xt},set layerId(e){if(e===void 0&&i.layers.length===0||!Number.isNaN(Number(e))&&e>=0&&e<i.layers.length){if(xt=Number(e),e===void 0)return;O(i,l),F(),Ue(),Ie(l),Te(l),de(i.layers[e].style),_.checked=l.activeLayer.closePath,M.checked&&B(i.layers[e].transforms)}},get mode(){return Lt},set mode(e){yn.includes(e)&&(Lt=e,re.modes.value=e,document.body.dataset.mode=e)},shapeStart:{},get transformLayerNotDrawing(){return St},set transformLayerNotDrawing(e){vt(e)&&(St=e)},get transformTarget(){return(l.transformLayerNotDrawing?l.activeLayer:i).transforms}};document.addEventListener("initializeCanvas",he);window.addEventListener("DOMContentLoaded",()=>{Object.assign(l,{cmd:"M",layerId:i.layers.length?0:void 0,mode:i.layers[0]?.mode||f.mode}),he()},{once:!0});var o=l;var hn=e=>{e.dataTransfer.setData("text",e.target.dataset.layerId),e.dataTransfer.effectAllowed="move"},Cn=({target:e})=>{l.activeLayer.label=e.textContent.replace(/\n/g,/\s/).trim(),m("changeLabel")};function Ue(){!l.activeLayer||l.activeLayer.points.forEach(q(l.activeLayer,l.layerId))}function Ce(e=L.childElementCount){let t=mt.cloneNode(!0),[n,r]=t.children;t.dataset.layerId=e,t.ondragstart=hn,n.oninput=Cn,u(n,{textContent:i.layers[e]&&i.layers[e].label||`Layer ${e+1}`}),u(r,{value:e,checked:l.layerId===D.length}),L.append(t),H(e),Se.display="none"}function He(){let e=w.length;for(Se.display=e?"none":"initial";L.childElementCount!==e;)L.lastChild.remove();e===0?l.layerId=void 0:l.layerId===e?l.layerId-=1:(l.layerId===void 0&&(l.layerId=0),O(i,l),H(l.layerId),de(l.activeLayer.style),Ue(),l.mode=l.activeLayer.mode),D[l.layerId]&&(D[l.layerId].checked=!0)}function he(){F(),[...w].forEach(e=>e.remove()),He(),Ue(),x.append(...i.layers.map((e,t)=>{let n=Y[e.mode],r=e.mode==="path"?{d:`${e.points.map(ie).join(" ")}${e.closePath?"Z":""}`}:e.points[0]||{};return I(n)({"data-layer-id":t,...e.style,...r,transform:N(e.transforms)})})),i.layers.forEach((e,t)=>Ce(t)),_.checked=l.activeLayer&&l.activeLayer.closePath,Ie(l),O(i,l),B(l.transformTarget),M.checked=l.transformLayerNotDrawing,de(l.activeLayer?.style||f.style),Te(l),me(i)}var vn=["data-layer-id","transform"],X=Ne.getContext("2d"),jt=e=>{Object.assign(Re,{download:`My_SVG.${i.outputConfig["file-format"]}`,href:e}),Re.click()},Et=e=>window.navigator.clipboard.writeText(e),Ot={C:Qe,Z:ue,Y:fe};window.onkeyup=({key:e})=>{je[e]&&m("keyup")};G.onchange=()=>m("setTransform");function ve(){i.layers.push(dt(o.mode,(o.activeLayer?at:Oe)(o.mode),C(f.transforms))),o.layerId=y(i.layers),x.append(I(Y[o.mode])({"data-layer-id":o.layerId})),Ce(o.layerId)}function Tt(e){o.activeLayer||ve();let[t,n]=k(e),{points:r}=o.activeLayer;V[o.mode].mkPoint(o,r,t,n,q,Ge),o.mode==="path"&&T.lastElementChild.dispatchEvent(new Event("pointerdown")),De(o.layerId),$(o.layerId)}function It(){let e=o.transformLayerNotDrawing?[o.activeSVGElement,o.activeLayer.transforms]:[p.firstElementChild,i.transforms];bn(...e),O(i,o)}function kt(){Object.assign(i,{layers:[],outputConfig:{...f.outputConfig},transforms:C(f.transforms)}),he(),m("clear")}function Mt({target:e}){if(o.arcCmdConfig[e.name]=e[e.type==="checkbox"?"checked":"value"],!o.activeLayer)return;let t=ce(o.activeLayer.points);!t||(Object.assign(t,J(o.arcCmdConfig)),$(o.layerId),m("configArcCmd"))}function Bt({target:{name:e,value:t}}){i.outputConfig[e]=t,Be(),m("configOutput")}function $t(){Et($e())}function At(){Et(pe())}function Ye(){if(!o.activeLayer?.points.length)return;let e=o.activeLayer.points.pop();if(m("deleteLastPoint"),e.cmd)Ge(e.cmd),$(o.layerId);else{let t=o.activeSVGElement;F(),t.getAttributeNames().filter(n=>!vn.includes(n)).forEach(n=>t.removeAttribute(n))}}function Pt(){!w.length||(i.layers.splice(o.layerId,1),o.activeSVGElement.remove(),F(),He(),m("deleteLayer"))}function Qe(){i.layers.splice(o.layerId,0,C(o.activeLayer)),o.activeSVGElement.after(o.activeSVGElement.cloneNode(!0)),o.layerId+=1,Ce(o.layerId),m("ctrl+c")}function Dt(e){if(!o.drawingShape)return;o.drawingShape=!1;let[t,n]=k(e),{points:r=[]}=o.activeLayer,a={hor:Math.abs(o.shapeStart.x-t),vert:Math.abs(o.shapeStart.y-n)};Object.assign(r[0],o.mode==="rect"?{x:Math.min(o.shapeStart.x,t),y:Math.min(o.shapeStart.y,n),width:a.hor,height:a.vert}:{rx:a.hor,ry:a.vert}),m("drawShape"),q(o.activeLayer,o.layerId)(S(r),y(r)),p.onpointermove=null}function Rt(e){if(window.location.hash!=="#drawing")return;let{key:t}=e;if(t==="F12"||(t==="Enter"&&e.target.contentEditable&&e.target.blur(),document.activeElement!==document.body))return;let n=je[t];if(e.ctrlKey&&Ot[t.toUpperCase()])Ot[t.toUpperCase()]();else if(n){if(!o.activeLayer&&!e.ctrlKey)return;let{transforms:{translate:r}}=e.ctrlKey?i:o.activeLayer,{cb:a,prop:s}=n;r[s]=a(+r[s]),O(i,o)}else t==="Backspace"?Ye():U.includes(t.toUpperCase())&&(o.cmd=t.toUpperCase());e.preventDefault()}function Nt(e){let n=+e.target.closest("label").dataset.layerId,r=w[n],a=+e.dataTransfer.getData("text"),s=w[a],[c]=i.layers.splice(a,1);i.layers.splice(n,0,c),m("reorderLayer"),a<n?r.after(s):x.insertBefore(s,r),a!==o.layerId?a>o.layerId&&n<=o.layerId?o.layerId+=1:a<o.layerId&&n>o.layerId&&(o.layerId-=1):o.layerId=n,H(Math.min(a,n),Math.max(a,n)+1),D[o.layerId].checked=!0,e.preventDefault()}function Vt(){let{transforms:e}=f;M.checked&&o.activeLayer?o.activeLayer.transforms=C(e):i.transforms=C(e),O(i,o),B(e),m("resetTransforms")}function bn(e,t){let{x:n,y:r,width:a,height:s}=e.getBBox(),c=[Math.trunc(n+a*.5),Math.trunc(r+s*.5)];[R.rotate[1].value,R.rotate[2].value]=c,[t.rotate[1],t.rotate[2]]=c,m("setCenterofRotation")}function Ft({target:{value:e}}){o.cmd=e}function zt({target:{name:e,value:t}}){!o.activeLayer||(o.activeLayer.style[e]=t,e==="fill"&&o.activeLayer.style["fill-opacity"]==="0"&&(o.activeLayer.style["fill-opacity"]="1"),De(o.layerId))}z.onchange=()=>m("setFillOrStroke");function _t({target:{value:e}}){let t=+e;o.mode=i.layers[t].mode,o.layerId=t}function Gt({target:{value:e},currentTarget:t}){if(o.drawingShape){t.modes.value=o.mode;return}if(o.mode=e,!!o.activeLayer)if(o.activeLayer.points.length)ve();else{o.activeLayer.mode=o.mode;let n=I(Y[o.mode])({"data-layer-id":o.layerId}),r=o.activeSVGElement;r.replaceWith(n),r.remove(),Object.keys(o.activeLayer.style).forEach(a=>{a in f.styleRelevancies&&!f.styleRelevancies[a].includes(o.mode)&&delete o.activeLayer.style[a]}),Object.assign(o.activeLayer.style,Oe(o.mode)),m("setMode")}}function Ut({target:{classList:e,dataset:t,name:n,value:r}}){if(e.contains("transform-config")){let{transform:a,id:s}=t;o.transformTarget[a][+s]=r}else o.transformTarget[n]=r;O(i,o)}function Ht({target:{checked:e}}){e?B(o.activeLayer?o.activeLayer.transforms:f.transforms):B(i.transforms),o.transformLayerNotDrawing=e}function Qt({target:e}){!o.activeLayer||(o.activeLayer.closePath=e.checked,$(o.layerId),m("togglePathClosing"))}function Yt(){let e=$e();i.outputConfig["file-format"]==="svg"?jt(e):(ye.src=e,ye.onload=()=>{X.clearRect(0,0,X.canvas.width,X.canvas.height),Object.assign(X.canvas,{width:i.outputConfig.width,height:i.outputConfig.height}),X.drawImage(ye,0,0),jt(Ne.toDataURL())})}W.oninput=Mt;ee.onchange=Ft;document.getElementById("reset-transforms").onclick=Vt;document.getElementById("get-markup").onclick=At;document.getElementById("get-data-uri").onclick=$t;document.getElementById("center-rotation-btn").onclick=It;document.getElementById("center-vb").onclick=ge;document.getElementById("add-layer").onclick=ve;document.getElementById("del-layer").onclick=Pt;document.getElementById("clear-all").onclick=kt;document.getElementById("del-last-point").onclick=Ye;document.getElementById("duplicate-layer").onclick=Qe;document.querySelector('a[data-tab-name="output"]').onclick=Ae;We.onclick=Yt;z.oninput=zt;L.onchange=_t;L.ondrop=Nt;re.onchange=Gt;ne.oninput=Bt;_.onchange=Qt;oe.addEventListener("click",fe);p.addEventListener("pointerdown",Tt);document.addEventListener("pointerup",Dt);G.oninput=Ut;M.onchange=Ht;se.addEventListener("click",ue);window.onkeydown=Rt;})();
